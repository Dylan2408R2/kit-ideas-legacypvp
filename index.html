<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PvP Kit Builder - MoreLikeMinecraft</title>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        :root {
            --wa-green: #25D366;
            --mc-gui: #c6c6c6;
            --mc-slot: #8b8b8b;
        }

        body {
            background-color: #121212; color: white; font-family: 'Segoe UI', sans-serif;
            display: flex; flex-direction: column; align-items: center; padding: 15px; margin: 0;
            user-select: none; touch-action: manipulation;
        }

        h1 { color: var(--wa-green); text-shadow: 2px 2px #000; margin: 10px 0; font-size: 1.4rem; }

        /* Contenedor Inventario */
        .inventory-wrapper {
            background-color: var(--mc-gui); padding: 10px; border: 4px solid #555;
            box-shadow: inset -4px -4px 0 #333, inset 4px 4px 0 #fff;
        }

        .grid { display: grid; grid-template-columns: repeat(9, 42px); gap: 2px; }

        .slot {
            width: 38px; height: 38px; background-color: var(--mc-slot);
            border: 2px solid; border-color: #373737 #ffffff #ffffff #373737;
            display: flex; justify-content: center; align-items: center; position: relative;
        }

        .item-img { width: 32px; height: 32px; image-rendering: pixelated; cursor: pointer; }

        /* Brillo de encantamiento */
        .enchanted::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(176, 0, 255, 0.3); box-shadow: inset 0 0 10px #aa00ff; pointer-events: none;
        }

        /* Selector de items */
        .picker {
            display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;
            background: #252525; padding: 12px; border-radius: 10px; margin-bottom: 20px;
            max-width: 450px; border: 1px solid #444;
        }

        .drag-source {
            width: 44px; height: 44px; background: #333; border: 1px solid #555;
            display: flex; justify-content: center; align-items: center; cursor: grab;
        }

        .btn-send {
            margin-top: 25px; background-color: var(--wa-green); color: white; border: none;
            padding: 15px 40px; font-size: 1.1rem; font-weight: bold; border-radius: 50px; cursor: pointer;
            box-shadow: 0 4px #128c3e;
        }

        /* Modal */
        #modal {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #222; border: 2px solid var(--wa-green); padding: 20px; z-index: 2000; width: 260px;
            border-radius: 12px;
        }
        .overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.85); z-index: 1500; }
        .enc-row { margin-bottom: 12px; display: flex; align-items: center; gap: 10px; }
    </style>
</head>
<body>

    <h1>PvP Loadout Builder</h1>
    <p style="color:#aaa; font-size:0.8rem; margin-bottom:15px">Arrastra los √≠tems al inventario</p>
    
    <div class="picker" id="item-source">
        <!-- √çtems con rutas corregidas para el repositorio MoreLikeMinecraft (Minetest Style) -->
        <div class="drag-source" data-id="Espada Di" data-enc="true" data-url="https://raw.githubusercontent.com/nebulimity/MoreLikeMinecraft/main/default/default_tool_diamondsword.png"><img src="https://raw.githubusercontent.com/nebulimity/MoreLikeMinecraft/main/default/default_tool_diamondsword.png" class="item-img"></div>
        
        <div class="drag-source" data-id="Pala Di" data-enc="true" data-url="https://raw.githubusercontent.com/nebulimity/MoreLikeMinecraft/main/default/default_tool_diamondshovel.png"><img src="https://raw.githubusercontent.com/nebulimity/MoreLikeMinecraft/main/default/default_tool_diamondshovel.png" class="item-img"></div>
        
        <div class="drag-source" data-id="Hacha Di" data-enc="true" data-url="https://raw.githubusercontent.com/nebulimity/MoreLikeMinecraft/main/default/default_tool_diamondaxe.png"><img src="https://raw.githubusercontent.com/nebulimity/MoreLikeMinecraft/main/default/default_tool_diamondaxe.png" class="item-img"></div>
        
        <div class="drag-source" data-id="Lava" data-enc="false" data-url="https://raw.githubusercontent.com/nebulimity/MoreLikeMinecraft/main/bucket/bucket_lava.png"><img src="https://raw.githubusercontent.com/nebulimity/MoreLikeMinecraft/main/bucket/bucket_lava.png" class="item-img"></div>
        
        <div class="drag-source" data-id="Manzana" data-enc="false" data-url="https://raw.githubusercontent.com/nebulimity/MoreLikeMinecraft/main/farming/farming_apple.png"><img src="https://raw.githubusercontent.com/nebulimity/MoreLikeMinecraft/main/farming/farming_apple.png" class="item-img"></div>

        <div class="drag-source" data-id="Pan" data-enc="false" data-url="https://raw.githubusercontent.com/nebulimity/MoreLikeMinecraft/main/farming/farming_bread.png"><img src="https://raw.githubusercontent.com/nebulimity/MoreLikeMinecraft/main/farming/farming_bread.png" class="item-img"></div>

        <div class="drag-source" data-id="TNT" data-enc="false" data-url="https://raw.githubusercontent.com/nebulimity/MoreLikeMinecraft/main/tnt/tnt_top.png"><img src="https://raw.githubusercontent.com/nebulimity/MoreLikeMinecraft/main/tnt/tnt_top.png" class="item-img"></div>
    </div>

    <div class="inventory-wrapper">
        <div class="grid" id="main-inv"></div>
        <div style="height:12px"></div>
        <div class="grid" id="hotbar"></div>
    </div>

    <button class="btn-send" onclick="sendWhatsApp()">ENVIAR AL GRUPO</button>

    <div class="overlay" id="overlay" onclick="closeModal()"></div>
    <div id="modal">
        <h3 id="mod-title">Encantar √çtem</h3>
        <div id="mod-list"></div>
        <button class="btn-send" style="padding:10px; width:100%" onclick="closeModal()">Guardar</button>
        <button class="btn-send" style="padding:10px; background:#a33; margin-top:8px; width:100%; box-shadow:none" onclick="deleteItem()">Eliminar</button>
    </div>

    <script>
        let inventory = Array(36).fill(null);
        let currentIdx = null;

        const main = document.getElementById('main-inv');
        const hot = document.getElementById('hotbar');

        // Generar 36 slots (27 inv + 9 hotbar)
        for (let i = 0; i < 36; i++) {
            const slot = document.createElement('div');
            slot.className = 'slot';
            slot.dataset.index = i;
            if (i < 27) main.appendChild(slot); else hot.appendChild(slot);

            new Sortable(slot, {
                group: 'shared',
                animation: 150,
                onAdd: (evt) => {
                    const item = evt.item;
                    inventory[i] = {
                        name: item.dataset.id,
                        url: item.dataset.url,
                        canEnc: item.dataset.enc === "true",
                        enchants: []
                    };
                    // Si el item ven√≠a de otro slot, limpiamos el anterior
                    if (evt.from.dataset.index !== undefined) {
                        inventory[evt.from.dataset.index] = null;
                    }
                    item.remove();
                    render();
                }
            });
        }

        // Configurar el origen de √≠tems
        new Sortable(document.getElementById('item-source'), {
            group: { name: 'shared', pull: 'clone', put: false },
            sort: false
        });

        function render() {
            for (let i = 0; i < 36; i++) {
                const slot = document.querySelector(`.slot[data-index="${i}"]`);
                slot.innerHTML = '';
                const d = inventory[i];
                if (d) {
                    const img = document.createElement('img');
                    img.src = d.url;
                    img.className = 'item-img' + (d.enchants.length > 0 ? ' enchanted' : '');
                    img.onclick = () => openModal(i);
                    slot.appendChild(img);
                }
            }
        }

        function openModal(i) {
            currentIdx = i;
            const item = inventory[i];
            if (!item.canEnc) { if(confirm("¬øEliminar √≠tem?")) deleteItem(); return; }
            document.getElementById('mod-title').innerText = item.name;
            const list = document.getElementById('mod-list');
            list.innerHTML = '';
            ["Filo V", "Empuje II", "Protecci√≥n IV", "Eficiencia V", "Irrompibilidad III"].forEach(en => {
                const has = item.enchants.includes(en);
                list.innerHTML += `<div class="enc-row"><label><input type="checkbox" ${has?'checked':''} onchange="toggleEnc('${en}')"> ${en}</label></div>`;
            });
            document.getElementById('modal').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
        }

        function toggleEnc(en) {
            const item = inventory[currentIdx];
            const idx = item.enchants.indexOf(en);
            if (idx > -1) item.enchants.splice(idx, 1); else item.enchants.push(en);
            render();
        }

        function deleteItem() { inventory[currentIdx] = null; closeModal(); render(); }
        function closeModal() { document.getElementById('modal').style.display = 'none'; document.getElementById('overlay').style.display = 'none'; }

        function sendWhatsApp() {
            if (!inventory.some(x => x !== null)) return alert("El inventario est√° vac√≠o.");
            alert("Envialo a WhatsApp para que pueda ver tu idea");
            
            let text = "*NUEVA IDEA DE KIT* ‚öîÔ∏è\n\n";
            inventory.forEach((it, i) => { 
                if(it) {
                    text += `- *${it.name}* ${it.enchants.length ? `_(${it.enchants.join(", ")})_` : ''}\n`;
                }
            });
            
            const dataEncoded = btoa(JSON.stringify(inventory));
            const shareUrl = window.location.origin + window.location.pathname + "#kit=" + dataEncoded;
            text += "\nüîó *Ver dise√±o:* " + shareUrl;

            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
        }

        window.onload = () => {
            const hash = window.location.hash;
            if (hash.includes("#kit=")) {
                try { 
                    inventory = JSON.parse(atob(hash.split('=')[1])); 
                    render(); 
                } catch(e) { console.error("Error cargando kit"); }
            }
        }
    </script>
</body>
</html>
