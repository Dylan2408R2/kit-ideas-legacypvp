<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Legacy PvP Kit Maker</title>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        :root {
            --wa-green: #25D366;
            --mc-gui: #c6c6c6;
            --mc-border: #555;
            /* Tama√±o de un solo sprite en la imagen */
            --s: 33.33px; 
        }

        body {
            background-color: #121212;
            color: white;
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
        }

        h1 { color: var(--wa-green); text-shadow: 2px 2px #000; margin-bottom: 5px; }

        /* Estilo del Sprite */
        .sprite {
            width: 32px;
            height: 32px;
            background-image: url('items.jpg');
            background-repeat: no-repeat;
            background-size: 800px auto; /* Basado en el ancho de la imagen */
            image-rendering: pixelated;
            transform: scale(1.1);
        }

        /* --- COORDENADAS EXACTAS FAITHLESS --- */
        .item-sword  { background-position: calc(-7 * var(--s)) calc(-5 * var(--s)); }
        .item-shovel { background-position: calc(-5 * var(--s)) calc(-4 * var(--s)); }
        .item-axe    { background-position: calc(-4 * var(--s)) calc(-4 * var(--s)); }
        .item-rod    { background-position: calc(-4 * var(--s)) calc(-1 * var(--s)); }
        .item-bow    { background-position: calc(-14 * var(--s)) calc(-3 * var(--s)); }
        .item-pearl  { background-position: calc(-11 * var(--s)) calc(-10 * var(--s)); }
        .item-gapple { background-position: calc(-6 * var(--s)) calc(-12 * var(--s)); }
        .item-pot    { background-position: calc(-10 * var(--s)) calc(-9 * var(--s)); }
        .item-lava   { background-position: calc(0 * var(--s)) calc(-11 * var(--s)); }
        .item-web    { background-position: calc(-20 * var(--s)) calc(-9 * var(--s)); }
        .item-helmet { background-position: calc(-8 * var(--s)) calc(-4 * var(--s)); }
        .item-chest  { background-position: calc(-9 * var(--s)) calc(-4 * var(--s)); }

        /* Contenedor del Picker */
        .picker {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            justify-content: center;
            background: #252525;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #444;
            max-width: 420px;
            margin-bottom: 20px;
        }

        .drag-source {
            width: 40px;
            height: 40px;
            background: #333;
            border: 1px solid #555;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: grab;
        }

        /* Inventario */
        .inventory-wrapper {
            background-color: var(--mc-gui);
            padding: 10px;
            border: 4px solid var(--mc-border);
            box-shadow: inset -4px -4px 0 #333, inset 4px 4px 0 #fff;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(9, 40px);
            gap: 2px;
        }

        .slot {
            width: 36px;
            height: 36px;
            background-color: #8b8b8b;
            border: 2px solid;
            border-color: #373737 #ffffff #ffffff #373737;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        /* Efecto encantado */
        .enchanted::after {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(176, 0, 255, 0.25);
            box-shadow: inset 0 0 8px #aa00ff;
            pointer-events: none;
        }

        .btn-send {
            margin-top: 20px;
            background-color: var(--wa-green);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1rem;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 4px #15853c;
        }

        .btn-send:active { transform: translateY(2px); box-shadow: 0 2px #15853c; }

        /* Modal */
        #modal {
            display: none;
            position: fixed;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #222; border: 2px solid var(--wa-green);
            padding: 20px; border-radius: 12px; z-index: 2000;
        }
        .overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); z-index: 1500; }
    </style>
</head>
<body>

    <h1>Legacy PvP Kit Maker</h1>
    
    <div class="picker" id="item-source">
        <div class="drag-source" data-id="Espada" data-class="item-sword" data-enc="true"><div class="sprite item-sword"></div></div>
        <div class="drag-source" data-id="Pala" data-class="item-shovel" data-enc="true"><div class="sprite item-shovel"></div></div>
        <div class="drag-source" data-id="Hacha" data-class="item-axe" data-enc="true"><div class="sprite item-axe"></div></div>
        <div class="drag-source" data-id="Arco" data-class="item-bow" data-enc="true"><div class="sprite item-bow"></div></div>
        <div class="drag-source" data-id="Ca√±a" data-class="item-rod" data-enc="false"><div class="sprite item-rod"></div></div>
        <div class="drag-source" data-id="Perla" data-class="item-pearl" data-enc="false"><div class="sprite item-pearl"></div></div>
        <div class="drag-source" data-id="Manzana" data-class="item-gapple" data-enc="false"><div class="sprite item-gapple"></div></div>
        <div class="drag-source" data-id="Pocion" data-class="item-pot" data-enc="false"><div class="sprite item-pot"></div></div>
        <div class="drag-source" data-id="Lava" data-class="item-lava" data-enc="false"><div class="sprite item-lava"></div></div>
        <div class="drag-source" data-id="Cobweb" data-class="item-web" data-enc="false"><div class="sprite item-web"></div></div>
        <div class="drag-source" data-id="Casco" data-class="item-helmet" data-enc="true"><div class="sprite item-helmet"></div></div>
        <div class="drag-source" data-id="Pechera" data-class="item-chest" data-enc="true"><div class="sprite item-chest"></div></div>
    </div>

    <div class="inventory-wrapper">
        <div class="grid" id="main-inv"></div>
        <div style="height: 10px;"></div>
        <div class="grid" id="hotbar"></div>
    </div>

    <button class="btn-send" onclick="sendWhatsApp()">ENVIAR IDEA AL GRUPO</button>

    <div class="overlay" id="overlay" onclick="closeModal()"></div>
    <div id="modal">
        <h3 id="mod-title" style="margin-top:0">Encantar</h3>
        <div id="mod-list"></div>
        <button class="btn-send" style="padding:10px; margin-top:10px" onclick="closeModal()">Listo</button>
        <button class="btn-send" style="padding:10px; background:#a33; margin-top:8px; box-shadow: 0 4px #611;" onclick="deleteItem()">Eliminar</button>
    </div>

    <script>
        let inventoryData = Array(36).fill(null);
        let editingIdx = null;

        // Crear Slots
        const mainInv = document.getElementById('main-inv');
        const hotbar = document.getElementById('hotbar');

        for (let i = 0; i < 36; i++) {
            const slot = document.createElement('div');
            slot.className = 'slot';
            slot.dataset.index = i;
            if (i < 27) mainInv.appendChild(slot);
            else hotbar.appendChild(slot);

            new Sortable(slot, {
                group: { name: 'shared', pull: true, put: true },
                animation: 150,
                onAdd: (evt) => {
                    const fromPicker = evt.from.id === 'item-source';
                    const itemEl = evt.item;
                    
                    if (fromPicker) {
                        inventoryData[i] = {
                            name: itemEl.dataset.id,
                            class: itemEl.dataset.class,
                            canEnc: itemEl.dataset.enc === "true",
                            enchants: []
                        };
                    } else {
                        const fromIdx = evt.from.dataset.index;
                        inventoryData[i] = inventoryData[fromIdx];
                        inventoryData[fromIdx] = null;
                    }
                    itemEl.remove();
                    renderAll();
                }
            });
        }

        new Sortable(document.getElementById('item-source'), {
            group: { name: 'shared', pull: 'clone', put: false },
            sort: false, animation: 150
        });

        function renderAll() {
            for (let i = 0; i < 36; i++) {
                const slot = document.querySelector(`.slot[data-index="${i}"]`);
                slot.innerHTML = '';
                const d = inventoryData[i];
                if (d) {
                    const el = document.createElement('div');
                    el.className = 'slot-item' + (d.enchants.length > 0 ? ' enchanted' : '');
                    el.innerHTML = `<div class="sprite ${d.class}"></div>`;
                    el.onclick = () => openEnchant(i);
                    slot.appendChild(el);
                }
            }
        }

        function openEnchant(i) {
            editingIdx = i;
            const item = inventoryData[i];
            if (!item.canEnc) { if(confirm("¬øQuitar item?")) deleteItem(); return; }

            document.getElementById('mod-title').innerText = item.name;
            const list = document.getElementById('mod-list');
            list.innerHTML = '';
            ["Filo V", "Empuje II", "Protecci√≥n IV", "Eficiencia V"].forEach(en => {
                const checked = item.enchants.includes(en) ? 'checked' : '';
                list.innerHTML += `<div style="margin:10px 0"><label><input type="checkbox" ${checked} onchange="toggleEnchant('${en}')"> ${en}</label></div>`;
            });

            document.getElementById('modal').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
        }

        function toggleEnchant(en) {
            const item = inventoryData[editingIdx];
            const idx = item.enchants.indexOf(en);
            if (idx > -1) item.enchants.splice(idx, 1);
            else item.enchants.push(en);
            renderAll();
        }

        function deleteItem() { inventoryData[editingIdx] = null; closeModal(); renderAll(); }
        function closeModal() { document.getElementById('modal').style.display = 'none'; document.getElementById('overlay').style.display = 'none'; }

        function sendWhatsApp() {
            if (!inventoryData.some(x => x !== null)) return alert("¬°Pon algo en el inventario!");
            alert("Envialo a WhatsApp para que pueda ver tu idea");

            let text = "*NUEVO KIT LEGACY* ‚öîÔ∏è\n\n";
            inventoryData.forEach((it) => {
                if (it) {
                    text += `- *${it.name}*`;
                    if (it.enchants.length > 0) text += ` _(${it.enchants.join(", ")})_`;
                    text += "\n";
                }
            });

            const dataEncoded = btoa(JSON.stringify(inventoryData));
            const shareUrl = window.location.origin + window.location.pathname + "#kit=" + dataEncoded;
            text += "\nüîó *Mira el dise√±o aqu√≠:* " + shareUrl;

            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
        }

        window.onload = () => {
            const hash = window.location.hash;
            if (hash.startsWith("#kit=")) {
                try {
                    inventoryData = JSON.parse(atob(hash.split('=')[1]));
                    renderAll();
                } catch(e) {}
            }
        }
    </script>
</body>
</html>
