<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Legacy PvP Kit - Faithless Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        :root {
            --wa-green: #25D366;
            --mc-gui: #c6c6c6;
        }

        body {
            background-color: #1a1a1a;
            color: white;
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            margin: 0;
            overflow-x: hidden;
        }

        h1 { color: var(--wa-green); font-size: 1.4rem; margin: 10px 0; text-shadow: 2px 2px #000; }

        /* Estilo del Item usando Sprite Sheet */
        .sprite {
            width: 32px;
            height: 32px;
            background-image: url('items.jpg'); /* ASEG칔RATE DE QUE SE LLAME AS칈 EN TU GITHUB */
            background-size: 800px 800px; /* Tama침o total aproximado del atlas */
            image-rendering: pixelated;
            display: inline-block;
        }

        /* Contenedor del Inventario */
        .inventory-wrapper {
            background-color: var(--mc-gui);
            padding: 12px;
            border: 4px solid #555;
            box-shadow: inset -4px -4px 0 #333, inset 4px 4px 0 #fff;
            margin-top: 10px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(9, 42px);
            gap: 2px;
        }

        .slot {
            width: 38px;
            height: 38px;
            background-color: #8b8b8b;
            border: 2px solid;
            border-color: #373737 #ffffff #ffffff #373737;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .slot-item {
            width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer;
        }

        .enchanted::after {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(176, 0, 255, 0.3);
            box-shadow: inset 0 0 10px #aa00ff;
            pointer-events: none;
        }

        /* Men칰 de selecci칩n (Picker) */
        .picker {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            background: #2a2a2a;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #444;
            max-width: 400px;
        }

        .drag-source {
            width: 42px;
            height: 42px;
            background: #444;
            border: 1px solid #666;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: grab;
            border-radius: 4px;
        }

        .btn-send {
            margin-top: 20px;
            background-color: var(--wa-green);
            color: white;
            border: none;
            padding: 15px 35px;
            font-size: 1rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            width: 90%;
            max-width: 350px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        /* Modal */
        #modal {
            display: none;
            position: fixed;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #2a2a2a; border: 2px solid var(--wa-green);
            padding: 20px; border-radius: 12px; z-index: 2000; width: 280px;
        }
        .overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.85); z-index: 1500; }
        
        /* Coordenadas de los items de Legacy PvP (Faithless) */
        /* [x, y] en pixeles aprox. Puedes ajustarlos */
        .item-sword  { background-position: -234px -234px; }
        .item-axe    { background-position: -100px -234px; }
        .item-shovel { background-position: -167px -234px; }
        .item-rod    { background-position: -67px -33px; }
        .item-pearl  { background-position: -367px -467px; }
        .item-gapple { background-position: -134px -534px; }
        .item-notch  { background-position: -134px -534px; filter: hue-rotate(45deg) brightness(1.2); }
        .item-bow    { background-position: -167px -100px; }
        .item-web    { background-position: -100px -734px; }
        .item-pot    { background-position: -134px -434px; }
        .item-lava   { background-position: -33px -467px; }
        .item-fns    { background-position: -200px -134px; }
        .item-helmet { background-position: -267px -234px; }
        .item-chest  { background-position: -300px -234px; }
    </style>
</head>
<body>

    <h1>Legacy PvP Kit Maker</h1>
    <p style="font-size: 0.8rem; color: #aaa;">Arrastra los items para armar tu kit</p>

    <div class="picker" id="item-source">
        <div class="drag-source" data-id="Espada" data-class="item-sword" data-enc="true"><div class="sprite item-sword"></div></div>
        <div class="drag-source" data-id="Pala" data-class="item-shovel" data-enc="true"><div class="sprite item-shovel"></div></div>
        <div class="drag-source" data-id="Hacha" data-class="item-axe" data-enc="true"><div class="sprite item-axe"></div></div>
        <div class="drag-source" data-id="Ca침a" data-class="item-rod" data-enc="false"><div class="sprite item-rod"></div></div>
        <div class="drag-source" data-id="Arco" data-class="item-bow" data-enc="true"><div class="sprite item-bow"></div></div>
        <div class="drag-source" data-id="Perla" data-class="item-pearl" data-enc="false"><div class="sprite item-pearl"></div></div>
        <div class="drag-source" data-id="Gapple" data-class="item-gapple" data-enc="false"><div class="sprite item-gapple"></div></div>
        <div class="drag-source" data-id="Notch" data-class="item-notch" data-enc="false"><div class="sprite item-notch"></div></div>
        <div class="drag-source" data-id="Cobweb" data-class="item-web" data-enc="false"><div class="sprite item-web"></div></div>
        <div class="drag-source" data-id="Lava" data-class="item-lava" data-enc="false"><div class="sprite item-lava"></div></div>
        <div class="drag-source" data-id="Mechero" data-class="item-fns" data-enc="false"><div class="sprite item-fns"></div></div>
        <div class="drag-source" data-id="Pocion" data-class="item-pot" data-enc="false"><div class="sprite item-pot"></div></div>
        <div class="drag-source" data-id="Casco" data-class="item-helmet" data-enc="true"><div class="sprite item-helmet"></div></div>
        <div class="drag-source" data-id="Pechera" data-class="item-chest" data-enc="true"><div class="sprite item-chest"></div></div>
    </div>

    <div class="inventory-wrapper">
        <div class="grid" id="main-inv"></div>
        <div style="height: 10px;"></div>
        <div class="grid" id="hotbar"></div>
    </div>

    <button class="btn-send" onclick="sendWhatsApp()">ENVIAR IDEA AL GRUPO</button>

    <div class="overlay" id="overlay" onclick="closeModal()"></div>
    <div id="modal">
        <h3 id="mod-title" style="margin-top:0">Encantar</h3>
        <div id="mod-list"></div>
        <button class="btn-send" style="padding:10px; margin-top:10px" onclick="closeModal()">Listo</button>
        <button class="btn-send" style="padding:10px; background:#a33; margin-top:8px" onclick="deleteItem()">Eliminar</button>
    </div>

    <script>
        let inventoryData = Array(36).fill(null);
        let editingIdx = null;

        // Crear Slots
        const mainInv = document.getElementById('main-inv');
        const hotbar = document.getElementById('hotbar');

        for (let i = 0; i < 36; i++) {
            const slot = document.createElement('div');
            slot.className = 'slot';
            slot.dataset.index = i;
            if (i < 27) mainInv.appendChild(slot);
            else hotbar.appendChild(slot);

            new Sortable(slot, {
                group: { name: 'shared', pull: true, put: true },
                animation: 150,
                onAdd: (evt) => {
                    const fromPicker = evt.from.id === 'item-source';
                    const itemEl = evt.item;
                    const data = {
                        name: itemEl.dataset.id,
                        class: itemEl.dataset.class,
                        canEnc: itemEl.dataset.enc === "true",
                        enchants: []
                    };
                    
                    if (!fromPicker) {
                        const fromIdx = evt.from.dataset.index;
                        inventoryData[i] = inventoryData[fromIdx];
                        inventoryData[fromIdx] = null;
                    } else {
                        inventoryData[i] = data;
                    }
                    itemEl.remove();
                    renderAll();
                }
            });
        }

        new Sortable(document.getElementById('item-source'), {
            group: { name: 'shared', pull: 'clone', put: false },
            sort: false, animation: 150
        });

        function renderAll() {
            for (let i = 0; i < 36; i++) {
                const slot = document.querySelector(`.slot[data-index="${i}"]`);
                slot.innerHTML = '';
                const d = inventoryData[i];
                if (d) {
                    const el = document.createElement('div');
                    el.className = 'slot-item' + (d.enchants.length > 0 ? ' enchanted' : '');
                    el.innerHTML = `<div class="sprite ${d.class}"></div>`;
                    el.onclick = () => openEnchant(i);
                    slot.appendChild(el);
                }
            }
        }

        function openEnchant(i) {
            editingIdx = i;
            const item = inventoryData[i];
            if (!item.canEnc) { if(confirm("쯈uitar item?")) deleteItem(); return; }

            document.getElementById('mod-title').innerText = item.name;
            const list = document.getElementById('mod-list');
            list.innerHTML = '';
            ["Filo V", "Empuje II", "Protecci칩n IV", "Eficiencia V"].forEach(en => {
                const checked = item.enchants.includes(en) ? 'checked' : '';
                list.innerHTML += `<div style="margin:10px 0"><label><input type="checkbox" ${checked} onchange="toggleEnchant('${en}')"> ${en}</label></div>`;
            });

            document.getElementById('modal').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
        }

        function toggleEnchant(en) {
            const item = inventoryData[editingIdx];
            const idx = item.enchants.indexOf(en);
            if (idx > -1) item.enchants.splice(idx, 1);
            else item.enchants.push(en);
            renderAll();
        }

        function deleteItem() { inventoryData[editingIdx] = null; closeModal(); renderAll(); }
        function closeModal() { document.getElementById('modal').style.display = 'none'; document.getElementById('overlay').style.display = 'none'; }

        function sendWhatsApp() {
            if (!inventoryData.some(x => x !== null)) return alert("El inventario est치 vac칤o.");
            alert("Envialo a Whatsapp para que pueda ver tu idea");

            let text = "*KIT LEGACY (Faithless)* 丘덢잺\n\n";
            inventoryData.forEach((it) => {
                if (it) {
                    text += `- *${it.name}*`;
                    if (it.enchants.length > 0) text += ` _(${it.enchants.join(", ")})_`;
                    text += "\n";
                }
            });

            const dataEncoded = btoa(JSON.stringify(inventoryData));
            const shareUrl = window.location.origin + window.location.pathname + "#kit=" + dataEncoded;
            text += "\n游댕 *Ver kit:* " + shareUrl;

            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
        }

        window.onload = () => {
            const hash = window.location.hash;
            if (hash.startsWith("#kit=")) {
                try {
                    inventoryData = JSON.parse(atob(hash.split('=')[1]));
                    renderAll();
                } catch(e) {}
            }
        }
    </script>
</body>
</html>
