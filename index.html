<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Legacy PvP Kit Builder</title>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        :root {
            --wa-green: #25D366;
            --mc-gui: #c6c6c6;
            --mc-slot: #8b8b8b;
        }

        body {
            background-color: #1a1a1a; color: white; font-family: sans-serif;
            display: flex; flex-direction: column; align-items: center; padding: 15px; margin: 0;
        }

        /* Estilo Inventario */
        .inventory-wrapper {
            background-color: var(--mc-gui); padding: 10px; border: 4px solid #555;
            box-shadow: inset -4px -4px 0 #333, inset 4px 4px 0 #fff; margin-bottom: 20px;
        }

        .grid { display: grid; grid-template-columns: repeat(9, 42px); gap: 2px; }

        .slot {
            width: 38px; height: 38px; background-color: var(--mc-slot);
            border: 2px solid; border-color: #373737 #ffffff #ffffff #373737;
            display: flex; justify-content: center; align-items: center; position: relative;
        }

        .item-img { width: 32px; height: 32px; image-rendering: pixelated; cursor: pointer; }

        .enchanted::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(176, 0, 255, 0.3); box-shadow: inset 0 0 10px #aa00ff; pointer-events: none;
        }

        /* Picker */
        .picker {
            display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;
            background: #252525; padding: 12px; border-radius: 10px; margin-bottom: 20px; max-width: 450px;
        }

        .drag-source {
            width: 44px; height: 44px; background: #333; border: 1px solid #555;
            display: flex; justify-content: center; align-items: center; cursor: grab;
        }

        .btn-send {
            background-color: var(--wa-green); color: white; border: none;
            padding: 15px 40px; font-size: 1.1rem; font-weight: bold; border-radius: 50px; cursor: pointer;
        }

        #modal {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #222; border: 2px solid var(--wa-green); padding: 20px; z-index: 2000; width: 260px;
        }
        .overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.85); z-index: 1500; }
    </style>
</head>
<body>

    <h1 style="color:var(--wa-green)">Legacy Kit Builder</h1>
    
    <div class="picker" id="item-source">
        <!-- URLs confirmadas de PrismarineJS -->
        <div class="drag-source" data-id="Espada" data-enc="true" data-url="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.8.8/items/diamond_sword.png"><img src="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.8.8/items/diamond_sword.png" class="item-img"></div>
        
        <div class="drag-source" data-id="Pala" data-enc="true" data-url="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.8.8/items/diamond_shovel.png"><img src="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.8.8/items/diamond_shovel.png" class="item-img"></div>
        
        <div class="drag-source" data-id="Hacha" data-enc="true" data-url="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.8.8/items/diamond_axe.png"><img src="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.8.8/items/diamond_axe.png" class="item-img"></div>
        
        <div class="drag-source" data-id="Perla" data-enc="false" data-url="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.8.8/items/ender_pearl.png"><img src="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.8.8/items/ender_pearl.png" class="item-img"></div>
        
        <div class="drag-source" data-id="Gapple" data-enc="false" data-url="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.8.8/items/apple_golden.png"><img src="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.8.8/items/apple_golden.png" class="item-img"></div>
        
        <div class="drag-source" data-id="CaÃ±a" data-enc="false" data-url="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.8.8/items/fishing_rod_uncast.png"><img src="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.8.8/items/fishing_rod_uncast.png" class="item-img"></div>
        
        <div class="drag-source" data-id="Pocion" data-enc="false" data-url="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.8.8/items/potion_bottle_splash.png"><img src="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.8.8/items/potion_bottle_splash.png" class="item-img"></div>

        <div class="drag-source" data-id="TelaraÃ±a" data-enc="false" data-url="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.8.8/items/web.png"><img src="https://raw.githubusercontent.com/PrismarineJS/minecraft-assets/master/data/1.8.8/items/web.png" class="item-img"></div>
    </div>

    <div class="inventory-wrapper">
        <div class="grid" id="main-inv"></div>
        <div style="height:12px"></div>
        <div class="grid" id="hotbar"></div>
    </div>

    <button class="btn-send" onclick="sendWhatsApp()">ENVIAR AL GRUPO</button>

    <div class="overlay" id="overlay" onclick="closeModal()"></div>
    <div id="modal">
        <h3 id="mod-title">Encantar</h3>
        <div id="mod-list"></div>
        <button class="btn-send" style="padding:10px; width:100%" onclick="closeModal()">Listo</button>
        <button class="btn-send" style="padding:10px; background:#a33; margin-top:8px; width:100%" onclick="deleteItem()">Eliminar</button>
    </div>

    <script>
        let inventory = Array(36).fill(null);
        let currentIdx = null;

        const main = document.getElementById('main-inv');
        const hot = document.getElementById('hotbar');

        for (let i = 0; i < 36; i++) {
            const slot = document.createElement('div');
            slot.className = 'slot';
            slot.dataset.index = i;
            if (i < 27) main.appendChild(slot); else hot.appendChild(slot);

            new Sortable(slot, {
                group: 'shared',
                animation: 150,
                onAdd: (evt) => {
                    const item = evt.item;
                    inventory[i] = {
                        name: item.dataset.id,
                        url: item.dataset.url,
                        canEnc: item.dataset.enc === "true",
                        enchants: []
                    };
                    if (evt.from.dataset.index) inventory[evt.from.dataset.index] = null;
                    item.remove();
                    render();
                }
            });
        }

        new Sortable(document.getElementById('item-source'), {
            group: { name: 'shared', pull: 'clone', put: false },
            sort: false
        });

        function render() {
            for (let i = 0; i < 36; i++) {
                const slot = document.querySelector(`.slot[data-index="${i}"]`);
                slot.innerHTML = '';
                const d = inventory[i];
                if (d) {
                    const img = document.createElement('img');
                    img.src = d.url;
                    img.className = 'item-img' + (d.enchants.length > 0 ? ' enchanted' : '');
                    img.onclick = () => openModal(i);
                    slot.appendChild(img);
                }
            }
        }

        function openModal(i) {
            currentIdx = i;
            const item = inventory[i];
            if (!item.canEnc) { if(confirm("Â¿Eliminar?")) deleteItem(); return; }
            document.getElementById('mod-title').innerText = item.name;
            const list = document.getElementById('mod-list');
            list.innerHTML = '';
            ["Filo V", "Empuje II", "ProtecciÃ³n IV", "Eficiencia V"].forEach(en => {
                const has = item.enchants.includes(en);
                list.innerHTML += `<div><label><input type="checkbox" ${has?'checked':''} onchange="toggleEnc('${en}')"> ${en}</label></div><br>`;
            });
            document.getElementById('modal').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
        }

        function toggleEnc(en) {
            const item = inventory[currentIdx];
            const idx = item.enchants.indexOf(en);
            if (idx > -1) item.enchants.splice(idx, 1); else item.enchants.push(en);
            render();
        }

        function deleteItem() { inventory[currentIdx] = null; closeModal(); render(); }
        function closeModal() { document.getElementById('modal').style.display = 'none'; document.getElementById('overlay').style.display = 'none'; }

        function sendWhatsApp() {
            if (!inventory.some(x => x !== null)) return alert("Inventario vacÃ­o");
            alert("Envialo a WhatsApp para que pueda ver tu idea");
            let text = "*KIT LEGACY PVP* âš”ï¸\n\n";
            inventory.forEach(it => { if(it) text += `- *${it.name}* ${it.enchants.length?`_(${it.enchants.join(",")})_`:''}\n`});
            const url = window.location.origin + window.location.pathname + "#kit=" + btoa(JSON.stringify(inventory));
            window.open(`https://wa.me/?text=${encodeURIComponent(text + "\nðŸ”— Kit: " + url)}`, '_blank');
        }

        window.onload = () => {
            if (window.location.hash.includes("#kit=")) {
                inventory = JSON.parse(atob(window.location.hash.split('=')[1])); render();
            }
        }
    </script>
</body>
</html>
